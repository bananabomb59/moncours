{# src/EDiff/Bundle/AdminBundle/Resources/views/User/edit.html.twig #}

{% extends layout %}

{% block title %}{{ parent() }} | {% if app.session.get('eleve_ou_prof') == "prof" %}Professeur{% else %}Elève{% endif %}{% endblock %}

{% block body %}
    <div class="hero-unit utilisateur">
		
		{% if app.session.get('eleve_ou_prof') == "prof" %}
        <h1>Edition d'un professeur</h1>
        {% else %}
        <h1>Edition d'un élève</h1>
        {% endif %}
		
		<form action="{{ path('user_update', { 'id': entity.id }) }}" method="post" {{ form_enctype(edit_form) }}>
		    {{ form_widget(edit_form) }}
		    <p>
		        <button class="btn btn-large" type="submit">Modifier !</button>
		    </p>
		</form>
		
		</br>
		
		<div id="affectation">
		
			<div id="resultat_recherche"></div>
		
			<form id="form_valider_affectation" method="post">
	
			<input type="hidden" name="eleve" id="eleve" value="{{ eleve.id }}" />
		
		    <div>
		    	<label class="required" for="classe">Classe</label>
		    	<select required="required" name="classe">
		    		{% for classe in classes %}
						<option value="{{ classe.id }}" {% if (exist and eleveClasse.classe.id == classe.id) %} selected="selected" {% endif %}>{{ classe.libelle }}</option>
					{% endfor %}
		    	</select>
		    </div>
		    
		    <div>
		    	<label class="required" for="annee">Année</label>
		    	<select required="required" name="annee">
		    		{% for annee in annees %}
						<option value="{{ annee.id }}" {% if (exist and eleveClasse.annee.id == annee.id) %} selected="selected" {% endif %}>{{ annee.anneeDebut }} - {{ annee.anneeFin }}</option>
					{% endfor %}
		    	</select>
		    </div>
		    
		    <p>
		        <button class="btn btn-large" type="submit">Affecter à cette classe !</button>
		        <span id="loading2"><img src="/img/loading.gif" width="25" height="25"></span>
		    </p>
			</form>
		
		</div>
		
		<p>
	        {% if app.session.get('eleve_ou_prof') == "prof" %}
	        <a class="btn btn-primary btn" href="{{ path('user_prof') }}">
	        {% else %}
	        <a class="btn btn-primary btn" href="{{ path('user_eleve') }}">
	        {% endif %}
	            Retour à la liste
	        </a>

	        <form action="{{ path('user_delete', { 'id': entity.id }) }}" method="post">
	            {{ form_widget(delete_form) }}
	            
	            {% if app.session.get('eleve_ou_prof') == "prof" %}
		        <button class="btn btn" type="submit">Supprimer ce professeur</button>
		        {% else %}
		        <button class="btn btn" type="submit">Supprimer cet élève</button>
		        {% endif %}	
	            
	        </form>
		</p>

	</div>
	
<script>
{% if app.session.get('eleve_ou_prof') == "prof" %}
$('#ediff_bundle_adminbundle_usertype_droits').val("prof");
$("#affectation").hide();
{% else %}
$('#ediff_bundle_adminbundle_usertype_droits').val("eleve");
$("#affectation").show();
{% endif %}

$("#loading2").hide();

$("#form_valider_affectation").submit(function(){ 
    $("#loading2").show();

    var eleve = $("#eleve").val();
    var annee = $("select[name='annee'] > option:selected").val();
    var classe = $("select[name='classe'] > option:selected").val();
    var DATA = 'eleve=' + eleve + '&annee=' + annee + '&classe=' + classe;
    
    $.ajax({
        type: "POST",
        url: "{{ path('EDiffAdminBundle_validation_affectation') }}",
        data: DATA,
        cache: false,
        success: function(data){
           $('#resultat_recherche').html(data);
           $("#loading2").hide();
        }
    });    
    return false;
});

</script>

{% endblock %}